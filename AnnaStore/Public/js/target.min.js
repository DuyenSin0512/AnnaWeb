



$('#modal').modal({ backdrop: 'static', keyboard: false })
$(document).ready(function () {
    $('.dk-lg').click(function () {
        $('#exampleModal1').modal('hide');
        $('#exampleModal1').on('hidden.bs.modal', function () {
            $(this).find("input").val('').end();
        });
    })
    $('.dn-lg').click(function () {
        $('#exampleModal').modal('hide');
        $('#exampleModal').on('hidden.bs.modal', function () {
            $(this).find("input").val('').end();
        });
    })

})
// 
$(function () {
    $('.etd').on('keyup', function () {
        const num = parseInt($('.etd').val());
        if (num > 99) {
            parseInt($('.etd').val('99'));
        } else if ($('.etd').val() == 0 || $('.etd').val() == '') {
            parseInt($('.etd').val('1'));
        }
    });
})
// search admin
//$(function () {
//    $('#button-addon1').off('click').on('click', function (e) {
//        e.preventDefault();
//        const dataVal = $('input[name=searchAdmin]').val().trim();
//        const ref = window.location.href;
//        let Product = text.includes("Product");
//        if (Product) {
//            $.ajax({
//                url: 'Admin/Product',
//                type: 'POST',
//                data: {
//                    searchAdmin: dataVal,
//                },
//                dataType: 'json',
//                success: function (response) {
//                    if (response.result == 0) {
//                        WIYN();
//                    }
//                    else  {
//                        //location.reload();

//                    }
//                }
//            })
//        }

//    });
//});

// Back to top
$(function () {
    $(window).scroll(function () {
        if ($(this).scrollTop() != 0) {
            $('#bttop').fadeIn();
        }
        else {
            $('#bttop').fadeOut();
        }
    });
    $('#bttop').click(function () {
        $('body,html').animate(
            { scrollTop: 0 }, 800);
    });
});


$(function () {
    $('#btn_login_c').off('click').on('click', function (e) {
        e.preventDefault();

        const User = $('input[name=Name]').val().trim();
        const Password = $('input[name=Password]').val().trim();

        console.log(User, Password)
        if (User == '') {
            $('#nameHelp').html('Vui lòng nhập Tên tài khoản!');
        }
        else {
            $('#nameHelp').html('');
        }
        if (Password == '') {
            $('#passHelp').html('Vui lòng nhập mật khẩu!');
        }
        else {
            $('#passHelp').html('');
        }
        if (User == '' || Password == '') {
            return false;
        }
        $.ajax("/account/userlogin", {
            type: 'POST',
            data: { User: User, Password: Password },
            dataType: 'json',
            success: function (s) {
                if (s.s == 1) {
                    $('#nameHelp').text('Thông tin tài khoản không chính xác');
                    return;
                } else if (s.s == 2) {
                    $('#passHelp').text('Mật khẩu không chính xác');
                    return;
                } else if (s.s == 0) {
                    window.location.reload();
                    return;
                }
            }
        });
    });
});

$(function () {
    $('#btn_forgot_c').off('click').on('click', function (e) {
                            //window.location.reload();

        e.preventDefault();
        // Nhan gtri tu input and check dieu kien la email
        const User = $('input[name=Forgotemail]').val().trim();
        $('#passHelp').html('');
        if (User == '' || !User.includes('@')) {
            $('#errEmailinput').html('Vui lòng nhập Email khôi phục!');
            console.log(User)
            return false;
        }
        $('#errEmailinput').html('');
       // thanh cong thi goi den api
        $.ajax("/account/ForgotPassWord", {
            type: 'POST',
            data: { email: User },
            dataType: 'json',
            success: function (s) {
                if (s.Code == 1) {
                    //
                    Swal.fire({
                        icon: 'warning',
                        title: s.Message,
                        showCancelButton: false,
                        confirmButtonColor: '#4a90e2',
                        cancelButtonColor: '',
                        confirmButtonText: 'Ok'
                    })
                    //$('#nameHelp').text(s.Message);
                    return false;
                } else if (s.Code == 0) {
                    Swal.fire({
                        icon: 'success',
                        title: "Mật khẩu đã gửi vào email của bạn!",
                        showCancelButton: false,
                        confirmButtonColor: '#4a90e2',
                        cancelButtonColor: '',
                        confirmButtonText: 'Ok'
                    })
                    return;
                }
            }
        });

    });
});



$(function () {
    $('#btn_forgot_c-prev').off('click').on('click', function (e) {
        e.preventDefault();
        window.location.href = "/quen-mat-khau";

    });
});
$(function () {
    $('.shop input').click(function () {
        $('#nameHelp').html('');
        $('#passHelp').html('');
    })
});
$(function () {
    $('#idtrongKinh').off('click').on('click', function (e) {
        e.preventDefault();
        window.location.href = "/trong-kinh";
    })
})
function WIYN() {
    Swal.fire({
        icon: 'warning',
        title: "Bạn cần đăng nhập để tiếp tục!",
        showCancelButton: true,
        confirmButtonColor: '#4a90e2',
        cancelButtonColor: '',
        confirmButtonText: 'Đăng nhập'
    }).then((result) => {
        if (result.value) {
            $('#exampleModal1').modal('show');
            //window.location.replace("login");
        }
    })
}
function AwToast(icon, content, timer) {
    Swal.fire({
        icon: icon,
        title: content,
        timer: timer
    })
}
// Notification FE
$(window).on('load', function () {
    const mgs_type = $('input[name=u_mgs_type]').val();
    const msg = $('input[name=u_mgs]').val();
    if (mgs_type != '' && msg != '') {
        switch (mgs_type) {
            case 'success':
                AwToast(mgs_type, msg, 10000)
                break;
            case 'warning':
                AwToast(mgs_type, msg, 10000)
                break;
            case 'danger':
                AwToast(mgs_type, msg, 10000)
                break;
        }
    }
});

$(function () {
    $('.notready').click(function (e) {
        e.preventDefault();
        Swal.fire({
            icon: 'warning',
            title: 'Chức năng chưa sẵn sàng!',
            timer: 5000
        })
    })
})

function validateForm() {
    if ($('#email').val() == null || $('#email').val() == '') {
        Swal.fire('Bạn chưa nhập Email. Vui lòng nhập email!');
        return false;
    } else if (($('#address').val().trim() == null || $('#address').val().trim() == '')) {
        Swal.fire('Vui lòng nhập địa chỉ nhân hàng!');
        return false;
    }
    return true;
}

$(function () {
    $('#btnRate').off('click').on('click', function (e) {
        e.preventDefault();
        $.ajax({
            url: 'Site/AddRate',
            type: 'POST',
            data: {
                pID: $(this).data('id'),
                rate: $('#rate').val(),
                comment: $("#cmt").val()
            },
            dataType: 'json',
            success: function (response) {
                if (response.result == 0) {
                    WIYN();
                } else if (response.result == 1) {
                    AwToast('warning', 'Bạn cần mua sản phẩm này !');
                }
                else if (response.result == 2) {
                    AwToast('success', 'Đánh giá thành công !');
                    location.reload();

                }
            }
        })
    })
})

$(document).ready(function () {
    $('.checkAuth').click(function (e) {
        e.preventDefault();
        $.ajax({
            url: "/cart/checkauth",
            type: 'POST',
            success: function (response) {
                if (response == 1) {
                    window.location.href = "thanh-toan";
                } else {
                    WIYN();
                }
            }
        });
    });
});
$(function () {
    $('#buy-btn').off('click').on('click', function (e) {
        e.preventDefault();
        //console.log($(this).data('id') + $("#qtyDpt").val())
        // return
        $.ajax({
            url: 'cart/add',
            type: 'POST',
            data: {
                pid: $(this).data('id'),
                qty: $("#qtyDpt").val()
            },
            dataType: 'json',
            success: function (response) {
                if (response.result == 1) {
                    $('.slc').text(parseInt($('.slc').text()) + 1);
                    $('.list-cart').load('module/cart');
                    AwToast('success', 'Đã thêm sản phẩm vào giỏ hàng');

                } else if (response.result == 2) {
                    $('.list-cart').load('module/cart');
                    AwToast('success', 'Đã cập nhật lại số lượng sản phẩm trong giỏ hàng');
                }
                else if (response.result == 3) {
                    AwToast('error', 'Số lượng sản phẩm không đủ !');
                }
            }
        })
    })
})

$(function () {
    $('.m-remove-one').off('click').on('click', function (e) {
        e.preventDefault();

        $.ajax({
            url: 'cart/update',
            type: 'POST',
            data: {
                pid: $(this).data('id'),
                option: 'remove'
            },
            dataType: 'json',
            success: function (response) {
                if (response == 3) {
                    $('.slc').text(parseInt($('.slc').text()) - 1);
                    $('.list-cart').load('module/cart');
                    $('#checkout').load('module/icart');
                }
            }
        })
    })
})


//$(function () {
//    $('.remove-one').bind('click', function (e) {
//        e.preventDefault();
//        $.ajax({
//            url: 'cart/update',
//            type: 'POST',
//            data: {
//                pid: $(this).data('id'),
//                option: 'remove'
//            },
//            dataType: 'json',
//            success: function (response) {
//                if (response.result == 1) {
//                    $('.slc').text(parseInt($('.slc').text()) - 1);
//                    $('.list-cart').load('module/mitc');
//                    $('#checkout').load('module/icart');
//                    AwToast('info', 'Đã xóa sản phẩm khỏi giỏ hàng!', 5000);
//                    return;
//                }
//                AwToast('danger', '404!', 5000);
//            }
//        })
//        $(this).unbind('click');
//    })
//})

//$(function () {
//    $('#checkout').bind('click', function (e) {
//        $.ajax({
//            url: 'cart/Updaterrrr',
//            type: 'POST',
//            data: {
//                pid: $(this).data('id'),
//                option: $(this).data('options'),
//                qty: $('input[name=etd]').val()
//            },
//            dataType: 'json',
//            success: function (response) {
//                switch (response.result) {
//                    case 4:
//                        $('.list-cart').load('module/mitc');
//                        $('#checkout').load('module/icart');
//                        AwToast('success', 'Đã cập nhật lại sô lượng trong giỏ hàng!', 5000);
//                        break;
//                }
//            }
//        })
//        $(this).unbind('click');
//    });
//});


$(function () {
    $('.update').off('click').on('click', function (e) {
        e.preventDefault();

        $.ajax('cart/update', {

            type: 'POST',
            data: { pid: $(this).data('id'), option: $(this).data('options') },
            dataType: 'json',
            success: function (res) {
                if (res == 1 || res == 2) {
                    $('.list-cart').load('module/cart');
                    $('#checkout').load('module/icart');
                    return;
                } else if (res == 3) {
                    $('.list-cart').load('module/cart');
                    $('#checkout').load('module/icart');
                    AwToast('info', 'Đã xóa sản phẩm khỏi giỏ hàng!', 5000);
                    return;
                }
                AwToast('danger', '404!', 5000);
            }
        })
    })
})


//mouse - click


$(document).ready(function () {
    $('#thanh-toan').click(function (e) {
        e.preventDefault();
        if ($('#email').val() == null || $('#email').val() == '') {
            Swal.fire('Vui lòng nhập email!');
            return false;
        } else if (($('#address').val().trim() == null || $('#address').val().trim() == '')) {
            Swal.fire('Vui lòng nhập địa chỉ nhân hàng!');
            return false;
        }
        var paymentType = $('input[name="fav_language"]:checked').val();

        $.ajax({
            url: "/cart/checkauth",
            type: 'POST',
            success: function (f) {
                if (f.f == 0) {
                    WIYN();
                }
                else if (paymentType == "2") {
                    $.ajax({
                        url: "/cart/PaymentMoMo",
                        type: 'POST',
                        data: {
                            Email: $('#email').val(),
                            Phone: $('input[name=Phone]').val(),
                            Address: $('#address').val(),
                            FullName: $('input[name=FullName]').val(),
                            type: paymentType,
                        },
                        dataType: 'json',
                        success: function (pig) {
                            if (pig != null) {
                                window.location.href = pig;
                            } else {
                                window.location.href = "account/order";
                            }
                        }
                    })
                }
                else {
                    $.ajax({
                        url: "/cart/payment",
                        type: 'POST',
                        data: {
                            Email: $('#email').val(),
                            Phone: $('input[name=Phone]').val(),
                            Address: $('#address').val(),
                            FullName: $('input[name=FullName]').val(),
                            type: paymentType,
                        },
                        dataType: 'json',
                        success: function (pig) {
                            if (!pig) {
                                console.log(pig);
                            } else {
                                window.location.href = "account/order";
                            }
                        }
                    })
                }
            }
        })
    })
});

function productCountChange(id, val) {
    $.ajax({
        url: 'cart/Set',
        type: 'POST',
        data: {
            pid: id,
            qty: val
        },
        dataType: 'json',
        success: function (response) {
            if (response.result == 1) {
                $('.list-cart').load('module/cart');
                location.reload();
            }
            else if (response.result == 2) {
                AwToast('error', 'Số lượng sản phẩm không đủ !');
            }
        }
    })
}
$(".cart-plus-minus-button-checkOut").append('<div class="dec qtybutton btnqtycheckout">-</div><div class="inc qtybutton btnqtycheckout">+</div>');
$(".btnqtycheckout").on("click", function () {
    var $button = $(this);
    var oldValue = $button.parent().find("input").val();
    if ($button.text() == "+") {
        var newVal = parseFloat(oldValue) + 1;
    } else {
        if (oldValue > 0) {
            var newVal = parseFloat(oldValue) - 1;
        } else {
            newVal = 0;
        }
    }
    $button.parent().find("input").val(newVal);
    var id = $button.parent().find("input").data('id');
    var v = $button.parent().find("input").val();
    productCountChange(id, v);
});

function deleteOrder(idss) {
    $.ajax({
        url: '/order/changeStatus',
        type: 'POST',
        data: {
            id: idss, op: 0 
        },
        dataType: 'json',
        success: function (response) {
            if (response.s == 1) {
               
                location.reload();
            }
            else if (response.s == 2) {
                AwToast('error', 'Số lượng sản phẩm không đủ !');
            }
        }
    })
    window.location.reload();
    //$.ajax({
    //    url: '/order/changeStatus',
    //    type: 'POST',
    //    data: { id: idss, op: 0 },
    //    dataType: 'json',
    //    success: function (response) {
    //        console.log(response);
    //        if (response.s == 1) {
    //            Swal.fire({
    //                icon: 'warning',
    //                title: s.Message,
    //                showCancelButton: true,
    //                confirmButtonColor: '#4a90e2',
    //                cancelButtonColor: '',
    //                confirmButtonText: 'Ok'
    //            })
    //            //$('#nameHelp').text(s.Message);
    //            return false;
    //        } else if (response.s == 0) {
    //            Swal.fire({
    //                icon: 'success',
    //                title: "Xóa thành công!",
    //                showCancelButton: true,
    //                confirmButtonColor: '#4a90e2',
    //                cancelButtonColor: '',
    //                confirmButtonText: 'Ok'
    //            })
    //            return;
    //        }
    //    }, 
    //    Error: function (err) {

    //    }
    //});
};
